<!DOCTYPE html>
<html class="rootPage">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta charset="utf-8">
<head>
    <title>银行服务窗(Demo)</title>
    <link rel="stylesheet" type="text/css" href="css/bank.css"/>
</head>
<body>
<div class="wrap demo">
    <div class="top">
        <img src="img/topBar.png" width="205" height="35"/>
    </div>

    <div class="content">
        <img src="img/midContent.png" width="274" height="391"/>
    </div>

    <div class="footer">
        <img src="img/botTab.png" width="238" height="55"/>
        <div class="upLink" id="upContentBtn">

        </div>
    </div>
</div>

<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/util.js"></script>
<script>
    function getUrlParams(paraName) {
        var url = document.location.toString();
        var arrObj = url.split("?");

        if (arrObj.length > 1) {
            var arrPara = arrObj[1].split("&");
            var arr;

            for (var i = 0; i < arrPara.length; i++) {
                arr = arrPara[i].split("=");

                if (arr != null && arr[0] == paraName) {
                    return arr[1];
                }
            }
            return "";
        }
        else {
            return "";
        }
    }

    $(function(){
        var indUsrId = getUrlParams("userId");
        if(!indUsrId){
            indUsrId = "";
        }
        var _params={
            userId: indUsrId
        };
        //经纬度城市
        var _mock = {
            latitude: '31.233858',
            longitude: '121.663881',//经度
            cityCode: '310000',//城市code
            cityName:encodeURI('上海'),
            timestamp:'1528700527'
        };

        var _sn='';
        //var _apiUrl = 'http://172.20.182.221:8787/open-h5/finduser'
        var _apiUrl= location.origin + '/open-h5/finduser';
        // 判断是否已授权(授权直接跳到open.95516.com,未授权跳转到授权页面)
        $('#upContentBtn').bind('click', function(){
            $.get(_apiUrl, _params, function(response){
                var _response = JSON.parse(response)
                if(response && _response.resp == '00'){
                    if(_response.params && _response.params.sn){
                        up.ui.hideLoading();
                        _sn = _response.params.sn;
                        if(_sn){
                            // 跳转到银联优惠的地址
                            location.href='http://202.101.25.188:10533/s/open/outApp/react/index.html#/?sn='+_sn+'&lat='+_mock.latitude+'&lon='+_mock.longitude+'&cityName='+_mock.cityName
                        } else{
                            location.href='html/bankAccess.html?userId='+indUsrId;
                        }
                    } else {
                        //up.ui.toast(_response.msg);
                        location.href='html/bankAccess.html?userId='+indUsrId;
                    }
                } else {
                    up.ui.toast(_response.msg)
                }


            });

        })

    })
</script>

</body>
</html>
